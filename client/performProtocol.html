<template name="performProtocolWrapper">
	{{#if this}}
		{{> performProtocol}}
	{{/if}}
</template>

<template name="performProtocol">
	<!-- for the outermost level, containerless binding syntax must be used! -->
	<h1>Perform a protocol</h1>
	<h2 data-bind="text: protocol.name"></h2>
	<table>
		<tr>
			<td><a href="" data-bind="click: addExperiment">+</a></td>
			<!-- ko foreach: experiments -->
				<td><a href="" data-bind="click: $parent.removeExperiment.bind($parent)">-</a></td>
			<!-- /ko -->
		</tr>
		<tr><th data-bind="attr: { colspan: colspan }"><h3>Parameters</h3></th></tr>
		<tr data-bind="foreach: protocol.params">
			<th><span data-bind="text: name"></span>:</th>
			<!-- ko if: multi -->
				<!--ko foreach: $root.experiments -->
					<td>Multi, TODO!</td>
				<!-- /ko -->
			<!-- /ko -->
			<!-- ko ifnot: multi -->
				<!--ko foreach: $root.experiments -->
					<td><select data-bind="value: singleParam($parent), options: possibleSources($parent), optionsText: 'text'"></select></td>
				<!-- /ko -->
			<!-- /ko -->
		</tr>
		<tr><th data-bind="attr: { colspan: colspan }"><h3>Steps</h3></th></tr>
		<!-- ko foreach: protocol.steps -->
			<tr><th data-bind="text: desc, attr: { colspan: $parent.colspan }"></th></tr>
			<!-- ko foreach: inputs -->
				<tr>
					<th data-bind="text: desc"></th>
					<!--ko foreach: $root.experiments -->
						<td><input type="text" data-bind="value: input($parentContext.$parentContext.$index(), $parentContext.$index())" /></td>
					<!-- /ko -->
				</tr>
			<!-- /ko -->
		<!-- /ko -->
	</table>

	<button data-bind="click: save">Save</button>
</template>
