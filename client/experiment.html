<template name="experiment">
	<h1 data-bind="text: $root.editMode() ? $root.newMode() ? 'Edit experiment' : 'Perform a protocol' : 'View experiment'"></h1>	
	<h2 data-bind="text: protocol.name"></h2>
	<table class="hierarchical">
		<tr data-bind="if: $root.editMode() &amp;&amp; $root.newMode()">
			<td><a href="" data-bind="click: addExperiment">+</a></td>
			<!-- ko foreach: experiments -->
				<td><a href="" data-bind="click: $parent.removeExperiment.bind($parent)">-</a></td>
			<!-- /ko -->
		</tr>
		<tr><th class="section" data-bind="attr: { colspan: colspan }"><h3>Parameters</h3></th></tr>
		<!-- ko foreach: protocol.params -->
			<tr>
				<th class="ul"><div class="li"><span data-bind="text: name"></span>:</div></th>
				<!-- ko if: multi -->
					<!--ko foreach: $root.experiments -->
						<td>
							<a href="" data-bind="visible: $root.editMode, click: addMultiParam($parent)">+</a>
							<ul data-bind="foreach: getParam($parent, true)">
								<li>
									<div data-bind="ifnot: $root.editMode">
										<span data-bind="text: paramValue().text"></span>
									</div>
									<div data-bind="if: $root.editMode">
										<select data-bind="value: paramValue, options: $parent.possibleSources.bind($parent)($parents[1]), optionsText: 'text'"></select>
										<a href="" data-bind="click: $parent.removeMultiParam($parents[1]).bind($parent)">-</a>
									</div>
								</li>
							</ul>
						</td>
					<!-- /ko -->
				<!-- /ko -->
				<!-- ko ifnot: multi -->
					<!--ko foreach: $root.experiments -->
						<td>
							<span data-bind="visible: !$root.editMode(), text: getParam($parent)().text"></span>
							<select data-bind="visible: $root.editMode, value: getParam($parent), options: possibleSources($parent), optionsText: 'text'"></select>
						</td>
					<!-- /ko -->
				<!-- /ko -->
			</tr>
		<!-- /ko -->
		<tr><th class="section" data-bind="attr: { colspan: colspan }"><h3>Steps</h3></th></tr>
		<!-- ko foreach: protocol.steps -->
			<tr><th class="ol"><div class="li" data-bind="text: desc, attr: { colspan: $parent.colspan }"></div></th></tr>
			<!-- ko foreach: inputs -->
				<tr>
					<th class="ul indent1"><div class="li" data-bind="text: desc"></div></th>
					<!-- ko foreach: $root.experiments -->
						<td>
							<!-- ko if: $parent.multiParam -->
								<dl data-bind="foreach: params[$parent.multiParam]">
									<dt data-bind="text: paramValue().text"></dt>
									<dd>
										<span data-bind="visible: !$root.editMode(), text: input($parentContext.$parentContext.$parentContext.$index(), $parentContext.$parentContext.$index())"></span>
										<input type="text" data-bind="visible: $root.editMode, value: input($parentContext.$parentContext.$parentContext.$index(), $parentContext.$parentContext.$index())" />
									</dd>
								</dl>
							<!-- /ko -->
							<!-- ko ifnot: $parent.multiParam -->
								<span data-bind="visible: !$root.editMode(), text: input($parentContext.$parentContext.$index(), $parentContext.$index())"></span>
								<input type="text" data-bind="visible: $root.editMode, value: input($parentContext.$parentContext.$index(), $parentContext.$index())" />
							<!-- /ko -->
						</td>
					<!-- /ko -->
				</tr>
			<!-- /ko -->
		<!-- /ko -->
	</table>

	<button data-bind="visible: $root.editMode, click: save">Save</button>
</template>
